#!/bin/sh /etc/rc.common

START=99

USE_PROCD=1

NAME=mt7628-agent
PROG=/usr/bin/$NAME

load_networks()
{
	local net
	config_get network "$1" network

	networks=" ${network} ${networks}"
}

start_service() {
	procd_open_instance

	procd_set_param command "$PROG" "$ARGS"
	procd_set_param stdout 1
	procd_set_param stderr 1
	procd_set_param respawn ${respawn_threshold:-3600} ${respawn_timeout:-5} ${respawn_retry:-5}

	procd_close_instance
}

reload_service() {
	stop
	start
}

service_triggers()
{
	procd_add_reload_trigger "wireless"
	local networks

	config_load wireless
	config_foreach load_networks wifi-iface

	[ -n "${networks}" ] && {
		for n in $networks ; do
			procd_add_interface_trigger "interface.*.up" "$n" /etc/init.d/mt7628-agent restart
		done
	}
}

