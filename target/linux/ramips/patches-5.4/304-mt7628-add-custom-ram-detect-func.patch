--- a/arch/mips/ralink/mt7620.c
+++ b/arch/mips/ralink/mt7620.c
@@ -10,6 +10,7 @@
 
 #include <linux/kernel.h>
 #include <linux/init.h>
+#include <linux/memblock.h>
 #include <linux/bug.h>
 
 #include <asm/mipsregs.h>
@@ -50,6 +51,8 @@
 /* does the board have sdram or ddram */
 static int dram_type;
 
+static u32 detect_magic __initdata = 0xaa5555aa;
+
 static struct rt2880_pmx_func i2c_grp[] =  { FUNC("i2c", 0, 1, 2) };
 static struct rt2880_pmx_func spi_grp[] = { FUNC("spi", 0, 3, 4) };
 static struct rt2880_pmx_func uartlite_grp[] = { FUNC("uartlite", 0, 15, 2) };
@@ -358,6 +361,21 @@ static struct rt2880_pmx_group mt7628an_
 	{ 0 }
 };
 
+static void __init mt7628_memory_detect(void)
+{
+	void *dm = (void *)KSEG1ADDR(&detect_magic);
+	phys_addr_t size;
+	phys_addr_t sz_min = MT7620_DDR2_SIZE_MIN * SZ_1M;
+	phys_addr_t sz_max = MT7620_DDR2_SIZE_MAX * SZ_1M;
+
+	for (size = sz_min; size < sz_max; size <<= 1) {
+		if (!memcmp(dm, dm + size, sizeof(detect_magic)))
+			break;
+	}
+
+	memblock_add(MT7620_DRAM_BASE, size);
+}
+
 static inline int is_mt76x8(void)
 {
 	return ralink_soc == MT762X_SOC_MT7628AN ||
@@ -698,9 +716,10 @@ void prom_soc_init(struct ralink_soc_inf
 	}
 
 	soc_info->mem_base = MT7620_DRAM_BASE;
-	if (is_mt76x8())
+	if (is_mt76x8()) {
 		mt7628_dram_init(soc_info);
-	else
+		soc_info->mem_detect = mt7628_memory_detect;
+	} else
 		mt7620_dram_init(soc_info);
 
 	pmu0 = __raw_readl(sysc + PMU0_CFG);
